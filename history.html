<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>📜 編集履歴一覧</title>

  <link rel="stylesheet" href="assets/style.css?v=4">
  <script src="assets/sidebar.js" defer></script>

  <style>
    .main-content {
      flex: 1;
      padding: 30px;
      margin-left: 230px;
      transition: margin-left 0.3s ease;
    }

    .main-title {
      font-size: 20px;
      color: #47bcec;
      border-left: 5px solid #47bcec;
      padding-left: 10px;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #1c1c1c;
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      border-bottom: 1px solid #333;
      padding: 10px;
      text-align: left;
    }

    th {
      background: #2a2a2a;
      color: #47bcec;
      font-weight: 700;
    }

    tr:hover {
      background: #222;
    }

    a.btn-edit {
      color: #00d0ff;
      text-decoration: none;
      font-weight: 600;
    }

    a.btn-edit:hover {
      text-decoration: underline;
    }

    .status {
      font-size: 13px;
      padding: 2px 6px;
      border-radius: 5px;
    }

    .status.edited {
      background: rgba(0,255,150,0.1);
      color: #00e6b0;
      border: 1px solid rgba(0,255,150,0.3);
    }
  </style>
</head>

<body>
  <main class="main-content">
    <h1 class="main-title">📜 編集履歴一覧</h1>
    <div style="margin-bottom: 15px;">
  <input type="text" id="searchBox" placeholder="タイトル・編集者・タグで検索" 
         style="width: 320px; padding: 6px 10px; border-radius: 6px; border: 1px solid #444; background:#222; color:#fff;">
</div>
    <table id="historyTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>タイトル（編集後）</th>
          <th>動画</th>
          <th>タグ数</th>
          <th>編集者</th>
          <th>更新日時</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <script>
    async function loadHistory() {
      try {
        const res = await fetch("history.json?t=" + Date.now(), { cache: "no-store" });
        const list = await res.json();

        const tbody = document.querySelector("#historyTable tbody");
        tbody.innerHTML = "";

        list.slice().reverse().forEach(p => {
          const tr = document.createElement("tr");

          const tags = (p.tags || []).filter(Boolean);
          const editor = p.editor || "船長";
          const updatedAt = p.updated_at
            ? new Date(p.updated_at).toLocaleString("ja-JP", { timeZone: "Asia/Tokyo" })
            : "-";

          tr.innerHTML = `
            <td>${p.id || "-"}</td>
            <td>${p.title_final || "(無題)"}</td>
            <td><a href="${p.video || "#"}" target="_blank">▶</a></td>
            <td>${tags.length}</td>
            <td>${editor}</td>
            <td>${updatedAt}</td>
            <td>
              <a class="btn-edit" href="history-edit.html?id=${p.id}">編集</a>
            </td>
          `;

          tbody.appendChild(tr);
        });
      } catch (err) {
        console.error("読み込み失敗:", err);
        alert("history.json の読み込みに失敗しました。");
      }
    }

    loadHistory();
    // === 🔍 検索機能 ===
document.getElementById("searchBox").addEventListener("input", (e) => {
  const keyword = e.target.value.toLowerCase();
  const rows = document.querySelectorAll("#historyTable tbody tr");

  rows.forEach(tr => {
    const text = tr.innerText.toLowerCase();
    tr.style.display = text.includes(keyword) ? "" : "none";
  });
});
  </script>
</body>
</html>
